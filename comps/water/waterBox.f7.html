<template>
  <div class="waterBox">
    <div class="waterMl">${$store.state.userData.water.todayMl}мл</div>
    <div class="water" id="waterAnii"></div>
  </div>
</template>
<style>
  </style>
<script>
  export default (props, {$store, $f7, $update, $el, $, $onMounted}) => {
    var bodymovin = require('../../js/lottie');



    if ($store.state.userData.water.todayMl == undefined ) {
  $store.state.userData.water.todayMl=0
  $f7.emit('e-backp')
}
if ($store.state.userData.water.goal == undefined ) {
  $store.state.userData.water.goal=1500
  $f7.emit('e-backp')
}

    $onMounted(()=>{
        
      let root = $el.value[0]
      let mlEl = root.firstChild
      let waterEl = root.lastChild

      let perc = $store.state.userData.water.todayMl<$store.state.userData.water.goal?
      $store.state.userData.water.todayMl/$store.state.userData.water.goal*100:100

      waterEl.style.transform= `translateY(${50-(perc/2)}%)`

      let animationn = lottie.loadAnimation({
          container: waterEl, // Required
          path: 'static/water.json', // Required
          renderer: 'svg', // Required
          loop: false,
          autoplay: false, // Optional
        })


        $f7.on('e-waterPageChange', (s)=>{
            if (s!='-') {
              animationn.play()
              setTimeout(() => {
                animationn.stop()
                let perc = $store.state.userData.water.todayMl<$store.state.userData.water.goal?
                $store.state.userData.water.todayMl/$store.state.userData.water.goal*100:100
                waterEl.style.transform= `translateY(${50-(perc/2)}%)`

          $update()
              }, 1000);
            }else{
                let perc = $store.state.userData.water.todayMl<$store.state.userData.water.goal?
                $store.state.userData.water.todayMl/$store.state.userData.water.goal*100:100
                waterEl.style.transform= `translateY(${50-(perc/2)}%)`
          $update()
            }

            
        })
    })

    
    return $render;
  }
</script>