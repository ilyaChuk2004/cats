<template>
  <div class="gaugeCont">
    
  <div class="gauge">
    <div class="glab">${$store.state.userData.lvl}</div>
  </div>
  </div>
</template>
<style>
  .glab{
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -55%);
    font-weight: bold;
    font-size: 26pt;
    color: #9FD3C2;
  }
  .gauge::after{
    content: 'уровень';
    color: rgba(97, 130, 119, 0.47);
    width: 100%;
    bottom: 0;
    left: 0;
    text-align: center;
    position: absolute;
    transform: translateY(100%);
    font-weight: bold;
    font-size: 10pt;
  }
  </style>
<script>
  export default (props, {$store, $f7, $update, $el, $, $onMounted}) => {

    if ($store.state.userData.lvl==undefined) {
      $store.state.userData.lvl=1
    }
    if ($store.state.userData.xp==undefined) {
      $store.state.userData.xp=0
    }
    if ($store.state.userData.xpGoal==undefined) {
      $store.state.userData.xpGoal=100
    }




    
    $onMounted(()=>{
      var ga = $f7.gauge.create({
        el:$el.value[0].lastChild,
        value:$store.state.userData.xp/$store.state.userData.xpGoal,
        size:props.size==undefined?80:props.size,
        borderWidth:8,
        borderColor:'#87E0C3',
        borderBgColor:$store.state.appData.theme=='light'?
        '#eeeeee':'#31423c',
      })

      $f7.on('e-changeLvl', (xp)=>{
        if ($store.state.userData.xp+xp>=0) {
          if ($store.state.userData.xp+xp>=$store.state.userData.xpGoal) {
            $store.state.userData.lvl++
            $store.state.userData.xpGoal+=300
            $store.state.userData.xp=($store.state.userData.xpGoal-300)-xp

            var not = $f7.notification.create({
        icon: '<i class="f7-icons">gift_fill</i>',
        title: 'Поздравление',
        titleRightText: 'сейчас',
        subtitle: 'У вас новый уровень!',
        text: `Теперь у вас ${$store.state.userData.lvl} уровень.`,
        closeTimeout: 3000,
      });

      not.open()
          }else{
            $store.state.userData.xp=$store.state.userData.xp+xp
          }
        }else {
          if ($store.state.userData.lvl>0){
            $store.state.userData.lvl--
            $store.state.userData.xpGoal-=300
          }else{
            $store.state.userData.lvl=0
            $store.state.userData.xpGoal=100
          }
          $store.state.userData.xp=$store.state.userData.xpGoal+($store.state.userData.xp+xp)

        }
        ga.update({
          value: $store.state.userData.xp/$store.state.userData.xpGoal,
        });
        $update()
        $f7.emit('e-backp')
      })
    })
    return $render;
  }
</script>