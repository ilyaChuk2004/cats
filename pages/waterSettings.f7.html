<template>
  <div class="page" data-name="settings">
    <div class="page-content">
      <div class="header">
        –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ–¥—ã <br /><br />
        –í–∞—à–∞ –Ω–æ—Ä–º–∞ ‚Äî ${$store.state.userData.water.goal}–º–ª
      </div>
      <div class="list links-list inset block-strong">
      <div class="title padding">–í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º:</div>

        <ul>

          <li class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">–ü–æ–ª</div>
              <div class="item-input-wrap input-dropdown-wrap">
                <select class="gen" placeholder="Please choose...">
                  <option value="Male">–ú—É–∂—Å–∫–æ–π</option>
                  <option value="Female">–ñ–µ–Ω—Å–∫–∏–π</option>
                </select>
              </div>
            </div>
          </li>

          <li class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">–í–µ—Å (–∫–≥)</div>
              <div class="item-input-wrap">
                <div class="range-slider range-slider-init" data-label="true">
                  <input class="weight" type="range" value="65" min="5" max="150" step="1" />
                </div>
              </div>
            </div>
          </li>

          <li class="item-content item-input">
            <div class="item-inner">
              <div class="item-title item-label">–ß–∞—Å—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –¥–µ–Ω—å</div>
              <div class="item-input-wrap">
                <div class="range-slider range-slider-init" data-label="true">
                  <input class="hours" type="range" value="5" min="0" max="24" step="1" />
                </div>
              </div>
            </div>
          </li>

          <button class="col button button-outline button-round ripple ripple-dark-white overflow-hidden" @click=${count}>–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

        </ul>
      </div>

      <div class="block block-strong inset no-padding-horizontal no-margin-vertical"> 
        <button class="col button button-outline button-round no-margin-vertical ripple ripple-dark-white overflow-hidden"  @click=${openPicker}>
          –ò–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–æ—Ä–º—É –≤—Ä—É—á–Ω—É—é...
        </button>
      </div>



      <div class="list accordion-list inset block-strong ">
      <div class="title padding">–°–∫–æ–ª—å–∫–æ –≤—ã–±—Ä–∞—Ç—å ü§î</div>

        <ul>
          <li class="accordion-item">
            <a href="" class="item-link item-content">
              <div class="item-inner">
                <div class="item-title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>
              </div>
            </a>
            <div class="accordion-item-content"><div class="block">
              <p>
                –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–≤–µ—Ä–∏—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É. –û–Ω –ø–æ–¥–±–µ—Ä—ë—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–¥—ã. –£–∫–∞–∂–∏—Ç–µ –≤–∞—à –ø–æ–ª, –≤–µ—Å, —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å —É –≤–∞—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞, –Ω–µ —Å–∏–¥—è—á–∞—è —Ä–∞–±–æ—Ç–∞, –ø—Ä–æ–≥—É–ª–∫–∏.
              </p>
              <p>
                –¢–æ–ª—å–∫–æ –ø–æ–º–Ω–∏—Ç–µ, –≤—ã –Ω–µ —Ç–∞–∫–æ–π –∫–∞–∫ –≤—Å–µ –∏ —Å—Ç–æ–∏—Ç –±–æ–ª—å—à–µ –≤–µ—Ä–∏—Ç—å —Å–µ–±–µ, —á–µ–º —Ç–∞–∫–∏–º —Ä–∞—Å—á—ë—Ç–∞–º. –û—Ç—Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ —Ü–µ–ª—å –≤—Ä—É—á–Ω—É—é –µ—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —á—Ç–æ —Ç–∞–∫ –Ω–∞–¥–æ.
              </p>
            </div></div>
          </li>
          <li class="accordion-item">
            <a href="" class="item-link item-content">
              <div class="item-inner">
                <div class="item-title">–ö–∞–∫ —Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å</div>
              </div>
            </a>
            <div class="accordion-item-content"><div class="block">
              <p>–ì–æ–≤–æ—Ä—è—Ç, –ø—Ä–∏ –û–†–í–ò –∏ –∏–Ω—Ñ–µ–∫—Ü–∏–æ–Ω–Ω—ã—Ö –±–æ–ª–µ–∑–Ω—è—Ö –Ω–∞–¥–æ –ø–∏—Ç—å –±–æ–ª—å—à–µ, —á—Ç–æ–±—ã —Å–∫–æ—Ä–µ–µ –≤—ã–∑–¥–æ—Ä–æ–≤–µ—Ç—å.</p>
              <p>–ï—Å–ª–∏ –ø—å—ë—Ç–µ –∫–æ—Ñ–µ, —Ç–æ –Ω–∞–¥–æ –ø–æ–±–æ–ª—å—à–µ –≤–æ–¥—ã, –∞ —Ç–æ –æ–Ω–æ —Ö–æ—Ä–æ—à–æ –∂–∏–¥–∫–æ—Å—Ç—å –≤—ã–≤–æ–¥–∏—Ç.</p>
            </div></div>
          </li>
          <li class="accordion-item">
            <a href="" class="item-link item-content">
              <div class="item-inner">
                <div class="item-title">–°–ø—Ä–æ—Å–∏—Ç–µ —É –≤—Ä–∞—á–∞</div>
              </div>
            </a>
            <div class="accordion-item-content"><div class="block">
              <p>–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø–æ—á–∫–∞–º–∏, —Å–µ—Ä–¥—Ü–µ–º –ª—É—á—à–µ —É–∑–Ω–∞—Ç—å —É –≤—Ä–∞—á–∞, —Å–∫–æ–ª—å–∫–æ –≤–∞–º –Ω–∞–¥–æ –ø–∏—Ç—å.</p>
            </div></div>
          </li>
          <li class="accordion-item">
            <a href="" class="item-link item-content">
              <div class="item-inner">
                <div class="item-title">–ß—Ç–æ —Ç–∞–∫–æ–µ –≤–æ–¥–∞</div>
              </div>
            </a>
            <div class="accordion-item-content"><div class="block">
              <p>–ê–ª–∫–æ–≥–æ–ª—å, —Å–ª–∞–¥–∫–∞—è –≥–∞–∑–∏—Ä–æ–≤–∫–∞ –Ω–µ —Å—á–∏–∞—é—Ç—Å—è. –û–Ω–∏ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –µ–¥–µ. –í–æ—Ç —Ç–∞–∫ –≤–æ—Ç.</p>
            </div></div>
          </li>
        </ul>
      </div>



    </div>
  </div>
</template>
<script>

  export default (props, { $store, $onMounted, $f7, $, $update, $el }) => {

    var pickerDevice;

    function openPicker() {
      pickerDevice.open()
    }

    function done(val) {
      //val - –Ω–æ–≤–∞—è —Ü–µ–ª—å

      // if (+val < $store.state.userData.water.goal && $store.state.userData.water.goal > $store.state.userData.water.todayMl) {
      //   $f7.emit('e-goal', '+')
      // }else if (+val >  $store.state.userData.water.goal && $store.state.userData.water.goal < $store.state.userData.water.todayMl) {
      //   $f7.emit('e-goal', '-')
      // }

      // if ($store.state.userData.water.todayMl >= $store.state.userData.water.goal &&  old---------------
      // $store.state.userData.water.todayMl+ml < $store.state.userData.water.goal) {

      //   $f7.emit('e-goal', '-')
      // }else if($store.state.userData.water.todayMl < $store.state.userData.water.goal &&
      // $store.state.userData.water.todayMl+ml >= $store.state.userData.water.goal){
      //   $f7.emit('e-goal', '+')
      // }
      let oldG = $store.state.userData.water.goal
      let todayMl = $store.state.userData.water.todayMl

      if (val>oldG && oldG <= todayMl && val > todayMl) {
        $f7.emit('e-goal', '-')
      } else if (val < oldG && oldG > todayMl && val <= todayMl){
        $f7.emit('e-goal', '+')
      }
      
      $store.state.userData.water.goal = +(val)
      $store.state.userData.water.hisVal = true

      app.emit('e-waterChange', 0)
      app.emit('e-waterPageChange')

      
      

      $store.state.gf.vibrate([30, 60, 30])

      $update()
      $f7.emit('e-backp')
    }

    function count() {
      let hours = $el.value[0].querySelector('.hours').value
      let weight = $el.value[0].querySelector('.weight').value
      let gen = $el.value[0].querySelector('.gen').value

      let water
      if (gen == 'Male') {
        water = (weight * 0.02) + hours * 0.3
      } else {
        water = (weight * 0.015) + hours * 0.25
      }

      let waterMl=Math.trunc(water * 1000)

      let confirm = $f7.dialog.create({
        closeByBackdropClick:true,
        title:'–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ–¥—ã',
        text:`–ü–æ —Ä–∞—Å—á—ë—Ç–∞–º, –≤–∞—à–∞ –Ω–æ—Ä–º–∞¬†‚Äî¬†${waterMl}–º–ª. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—ë?`,
        buttons:[
          {
            text:'–Ω–µ —Ç–æ',
            keyCodes:[27],
          },
          {
            text:'–¥–∞',
            bold:true,
            keyCodes:[13],
            onClick:()=>{
              done(waterMl)
            }
          }
        ]
      })

      if ($store.state.userData.water.goal!==waterMl) {
        confirm.open()
      }
    }


    $onMounted(() => {

      let arr144 = []
      for (let i = 0; i < 101; i = i + 2) {
        arr144.push(i * 100 + '–º–ª')
      }


      pickerDevice = $f7.picker.create({
        inputEl: '#demo-picker-device',
        rotateEffect: true,
        backdrop: true,
        cssClass: 'picker',
        openIn: 'popover',
        routableModals: true,
        toolbarCloseText: '–∫–∞–∫ —Ä–∞–∑ –¥–ª—è –º–µ–Ω—è',
        cols: [
          {
            values: arr144.slice(1)
          }
        ]
      });

      pickerDevice.once('opened', (el) => {
        el.setValue([Math.round(($store.state.userData.water.goal / 100)) * 100 + '–º–ª'], 300)

      })

      pickerDevice.on('opened', (el) => {

        $('.picker-3d .sheet-close').on('click', () => {
          done(+(pickerDevice.value[0].slice(0, -2)))

        })

        $('.picker-3d .picker-item').on('click', (e) => {
          console.log([...e.target.parentElement.classList].indexOf('picker-item-selected') !== -1);
        })
      })
      pickerDevice.on('change', (el) => {

        $store.state.gf.vibrate(30)
      })


    })
    return $render;
  };
</script>