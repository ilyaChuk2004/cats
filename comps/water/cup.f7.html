<template>
  <div @click=${(e)=>{change(e)}} class="cup holdEv" >
    <div class="cupIn ripple ripple-dark-white overflow-hidden">
      <img src="static/img/cups/${props.img1}.webp" alt="" style='transform:scale(${props.scale})'/>
    <div class="label">${props.ml}</div>

    <div style="position: absolute;" class="teach"></div>
    </div>
 </div>

</template>
<style>
  </style>
<script>
  export default (props, {$store, $f7, $update, $el, $, $onMounted}) => {
    var bodymovin = require('../../js/lottie');




    var toastBottom = $f7.toast.create({
            text: 'Клик правой кнокой мыши для отмены',
            closeButton: true,
            on: {
              close: function () {
                $store.state.userData.teach.rightCup=true
                $f7.emit('e-backp')
              },
            }
          });

    function change(e) {
      $store.state.gf.bounse(e.target)
      // navigator.vibrate([30])
      $store.state.gf.vibrate(30)

      $f7.emit('e-waterChange', +props.ml)
      $f7.emit('e-waterPageChange')
      var animation=false
      if ($store.state.appData.desktop && !$store.state.userData.teach.rightCup && +new Date - $store.state.appData.rihtClickTeachTime > 5000) {
        $store.state.appData.rihtClickTeachTime=+new Date
        setTimeout(() => {
          toastBottom.open();
          setTimeout(() => {
          animation = lottie.loadAnimation({
            container: $el.value[0].querySelector('.teach'), // Required
            path: 'static/rClick.json', // Required
            renderer: 'svg', // Required
            loop: false,
            autoplay: false, // Optional
          })

          animation.play()  
        animation.pause()

          setTimeout(() => {
            animation.setSpeed(1)  
          animation.play() 
          setTimeout(() => {
            animation.destroy()
          }, 2000);
            
          }, 2000);
        }, 3000);
        }, 1000);
      }
      
    }

    

    $onMounted(()=>{

      if ($store.state.appData.desktop) {
        $($el.value[0]).on('contextmenu', function (e) {
        toastBottom.close()

        $store.state.userData.teach.rightCup=true

        e.preventDefault()
        $f7.emit('e-waterChange', (+props.ml)*-1)
        $f7.emit('e-waterPageChange', '-')
      })
      }else{
        $($el.value[0]).on('taphold', function () {
        $f7.emit('e-waterChange', (+props.ml)*-1)
        $f7.emit('e-waterPageChange', '-')
      });
      }
        

      
    })
    return $render;
  }
</script>